<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >


<!-- 不使用namespace的话sql搜索定位会比较方便 -->
<mapper namespace="com.ulplanet.trip.modules.tms.dao.JourneyDayDao">

	<resultMap id="JourneyDay" type="com.ulplanet.trip.modules.tms.entity.JourneyDay">
            <result property="id" column="id"/>
            <result property="cityIds" column="city_ids"/>
            <result property="groupId" column="group_id"/>
            <result property="dayNumber" column="day_number"/>
            <result property="title" column="title"/>
            <result property="createDate" column="create_date"/>
            <result property="updateDate" column="update_date"/>
            <result property="remarks" column="remarks"/>
	</resultMap>
	
	<!-- 用于select查询公用抽取的列 -->
	<sql id="BaseColumns">
	    <![CDATA[
            id,group_id,day_number,title,remarks,city_ids
	    ]]>
	</sql>

<sql id="BaseWhere">
    <where>
                <if test="id != null and id != ''">
                    AND id = #{id}
                </if>
                <if test="groupId != null and groupId != ''">
                    AND group_id = #{groupId}
                </if>
                <if test="dayNumber != null and dayNumber != ''">
                    AND day_number = #{dayNumber}
                </if>
                <if test="title != null and title != ''">
                    AND title = #{title}
                </if>
                <if test="createDate != null and createDate != ''">
                    AND create_date = #{createDate}
                </if>
                <if test="updateDate != null and updateDate != ''">
                    AND update_date = #{updateDate}
                </if>
                <if test="remarks != null and remarks != ''">
                    AND remarks = #{remarks}
                </if>
    </where>

 </sql>


    <update id="updates"  parameterType="java.util.List">
        <foreach collection="list" item="item" index="index" open="" close="" separator=";">
            update journey_day
            <set>
                day_number=#{item.dayNumber}
            </set>
            where id = #{item.id}
        </foreach>
    </update>


	<insert id="insert">
            <![CDATA[
                INSERT INTO journey_day (
                    id ,
                    group_id ,
                    city_ids,
                    day_number ,
                    title ,
                    create_by ,
                    create_date ,
                    update_by ,
                    update_date ,
                    remarks 
                ) VALUES (
                    #{id} ,
                    #{groupId} ,
                    #{cityIds} ,
                    #{dayNumber} ,
                    #{title} ,
                    #{createBy.id} ,
                    #{createDate} ,
                    #{updateBy.id} ,
                    #{updateDate} ,
                    #{remarks} 
                )
            ]]>

	</insert>

    <insert id="inserts">
                INSERT INTO journey_day (
                    id ,
                    group_id ,
                    city_ids,
                    day_number ,
                    title ,
                    create_by ,
                    create_date ,
                    update_by ,
                    update_date ,
                    remarks
                ) VALUES
                <foreach collection="list" item="item" index="index" separator="," >
                        (
                            #{item.id} ,
                            #{item.groupId} ,
                            #{item.cityIds} ,
                            #{item.dayNumber} ,
                            #{item.title} ,
                            #{item.createBy.id} ,
                            #{item.createDate} ,
                            #{updateBy.id} ,
                            #{updateDate} ,
                            #{item.remarks}
                       )
                </foreach>

    </insert>
    
	<update id="update" >
        UPDATE journey_day
         <set>
                 <if test="groupId != null">
                      group_id = #{groupId},
                  </if>
                  <if test="cityIds != null">
                      city_ids = #{cityIds},
                  </if>
                 <if test="dayNumber != null">
                      day_number = #{dayNumber},
                  </if>
                 <if test="title != null">
                      title = #{title},
                  </if>
                 <if test="createDate != null">
                      create_date = #{createDate},
                  </if>
                 <if test="updateBy.id != null">
                      update_by = #{updateBy.id},
                  </if>
                 <if test="updateDate != null">
                      update_date = #{updateDate},
                  </if>
                 <if test="remarks != null">
                      remarks = #{remarks}
                  </if>
        </set>
              where id = #{id}
	</update>

    <delete id="delete">
        <![CDATA[
            DELETE FROM journey_day WHERE
            id = #{id} 
        ]]>
    </delete>

    <select id="findList" resultMap="JourneyDay">
        SELECT <include refid="BaseColumns" />
        <![CDATA[
		    FROM journey_day
	    ]]>
        <where>
            group_id = #{groupId}
        </where>

        order by day_number ASC
    </select>
    
    <select id="get" resultMap="JourneyDay">
		SELECT <include refid="BaseColumns" />
	    <![CDATA[
		    FROM journey_day 
	        WHERE 
		        id = #{id} 
	    ]]>
	</select>
	

		
    <select id="findPageCount" resultType="long">
        SELECT count(1) FROM journey_day
		<include refid="BaseWhere"/>
    </select>

    <select id="findPage" resultMap="JourneyDay">
    	SELECT <include refid="BaseColumns" />
	    FROM journey_day 
		<include refid="BaseWhere"/>
    </select>

	
</mapper>

