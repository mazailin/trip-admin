<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ulplanet.trip.modules.tim.dao.HotelDao">

	<resultMap id="Hotel" type="com.ulplanet.trip.modules.tim.entity.Hotel">
            <result property="id" column="id"/>
            <result property="city.id" column="city"/>
            <result property="name" column="name"/>
            <result property="address" column="address"/>
            <result property="phone" column="phone"/>
            <result property="longitude" column="longitude"/>
            <result property="latitude" column="latitude"/>
            <result property="description" column="description"/>
            <result property="remarks" column="remarks"/>
	</resultMap>
	
	<!-- 用于select查询公用抽取的列 -->
	<sql id="BaseColumns">
            hotel.id,hotel.name,hotel.address,hotel.phone,hotel.longitude
            ,hotel.latitude,hotel.description,hotel.remarks
	</sql>

	<insert id="insert">
            <![CDATA[
                INSERT INTO hotel (
                    id ,
                    city,
                    name ,
                    address ,
                    phone ,
                    longitude ,
                    latitude ,
                    description ,
                    create_by ,
                    create_date ,
                    update_by ,
                    update_date ,
                    remarks 
                ) VALUES (
                    #{id} ,
                    #{city.id} ,
                    #{name} ,
                    #{address} ,
                    #{phone} ,
                    #{longitude} ,
                    #{latitude} ,
                    #{description} ,
                    #{createBy.id} ,
                    #{createDate} ,
                    #{updateBy.id} ,
                    #{updateDate} ,
                    #{remarks} 
                )
            ]]>

	</insert>
    
	<update id="update" >
        UPDATE hotel
         <set>
                 <if test="name != null">
                      name = #{name},
                  </if>
                 <if test="address != null">
                      address = #{address},
                  </if>
                 <if test="city != null">
                     city = #{city.id},
                 </if>
                 <if test="phone != null">
                      phone = #{phone},
                  </if>
                 <if test="longitude != null">
                      longitude = #{longitude},
                  </if>
                 <if test="latitude != null">
                      latitude = #{latitude},
                  </if>
                 <if test="description != null">
                      description = #{description},
                  </if>
                 <if test="updateBy.id != null">
                      update_by = #{updateBy.id},
                  </if>
                 <if test="updateDate != null">
                      update_date = #{updateDate},
                  </if>
                 <if test="remarks != null">
                      remarks = #{remarks}
                  </if>
        </set>
        WHERE id = #{id}
	</update>

    <delete id="delete">
        <![CDATA[
            DELETE FROM hotel WHERE
            id = #{id} 
        ]]>
    </delete>
    
    <select id="get" resultMap="Hotel">
		SELECT <include refid="BaseColumns" />,
        hotel.city AS 'city.id',
        c.`name` AS 'city.name'
		    FROM hotel
            JOIN city c
              ON hotel.city = c.id
            WHERE hotel.id = #{id}
	</select>
	

		

    <select id="findList" resultType="Hotel">
    	SELECT <include refid="BaseColumns" />,
        hotel.city AS 'city.id',
        c.`name` AS 'city.name',
        sc.name AS 'createBy.name',
        su.name AS 'updateBy.name'
        FROM hotel
        JOIN city c
        ON hotel.city = c.id
        JOIN sys_user sc
        ON hotel.create_by = sc.id
        JOIN sys_user su
        ON hotel.update_by = su.id
		<where>
            <if test="name != null and name != ''">
                AND hotel.name like CONCAT('%', #{name}, '%')
            </if>
            <if test="city != null and city.id != null and city.id != ''">
                AND hotel.city = #{city.id}
            </if>
            <if test="createBy != null and createBy.name != null and createBy.name != ''">
                AND sc.name like CONCAT('%', #{createBy.name}, '%')
            </if>
            <if test="updateBy != null and updateBy.name != null and updateBy.name != ''">
                AND su.name like CONCAT('%', #{updateBy.name}, '%')
            </if>

        </where>
    </select>

	
</mapper>

